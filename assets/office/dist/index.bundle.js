(()=>{"use strict";const e={set:function(e,t,s,o,i,n){let r=`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;s instanceof Date&&(r+=`; expires=${s.toGMTString()}`),o&&(r+=`; path=${o}`),i&&(r+=`; domain=${i}`),n&&(r+="; secure"),document.cookie=r},get:function(e){let t=e+"=",s=document.cookie.split(";");for(let e=0;e<s.length;e++){let o=s[e];for(;" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return decodeURIComponent(o.substring(t.length,o.length))}return null},erase:function(t){e.set(t,"",-1)}},t=e;function s(){function e(){this.options={classModal:theme.prefix+"__modal",classBackdrop:theme.prefix+"__modal-backdrop",classOpen:"modal-open",classShow:"show"},this.selectors={openEl:document.querySelectorAll('[data-open="modal"]'),closeEl:document.querySelectorAll('[data-dismiss="modal"]')};for(let e=0;e<this.selectors.openEl.length;e++)this.selectors.openEl[e].addEventListener("click",this.show.bind(this),!1);for(let e=0;e<this.selectors.closeEl.length;e++)this.selectors.closeEl[e].addEventListener("click",this.hide.bind(this),!1)}return e.prototype=Object.assign({},e.prototype,{showBackdrop:function(){const e=document.querySelector("."+this.options.classBackdrop);if(null===e){let e=document.createElement("div");e.classList.add(this.options.classBackdrop,this.options.classShow),e.style.display="block",document.body.appendChild(e)}else e.style.display="block",e.classList.add(this.options.classShow)},hideBackdrop:function(){const e=document.querySelector("."+this.options.classBackdrop);e.classList.remove(this.options.classShow),setTimeout(function(){e.style.display="none"}.bind(this),200)},show:function(e){e.preventDefault();const t=e.currentTarget.getAttribute("href"),s=document.getElementById(t.replace("#",""));document.body.classList.add(this.options.classOpen),s.style.display="block",s.setAttribute("aria-modal","true"),this.showBackdrop(),setTimeout(function(){s.classList.add(this.options.classShow)}.bind(this),200)},hide:function(e){e.preventDefault();const t=function(e,t){let s,o;for(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some((function(e){return"function"==typeof document.body[e]&&(s=e,!0)}));e;){if(o=e.parentElement,o&&o[s](t))return o;e=o}return null}(e.currentTarget,"."+this.options.classModal);document.body.classList.remove(this.options.classOpen),t.classList.remove(this.options.classShow),setTimeout(function(){t.style.display="none",t.removeAttribute("aria-modal"),this.hideBackdrop()}.bind(this),200)}}),new e}document.addEventListener("DOMContentLoaded",(function(e){!function(){function e(){this.options={cookieBlockedPhone:theme.prefix+"_blockedSendPhone",classLoading:"btn--spinner",classInputCode:"input-code",classMessageBox:"js--form-group_message",classMessageBoxSuccess:"form-group_message--success",classMessageBoxError:"form-group_message--error",classError:"error",nameInputEmail:'[name="username"]'},this.selectors={step:document.querySelectorAll(".js--step"),linkTo:document.querySelectorAll(".js--link-to"),errorBox:document.querySelector("."+this.options.classMessageBox),putPhone:document.querySelector(".js--put-phone"),formPhone:document.querySelector('[name="loginWithPhone"]'),inputPhone:document.querySelector(".js--input-phone"),sendPhoneAgain:document.getElementById("send-phone-again"),formCode:document.querySelector('[name="loginWithCode"]'),inputsCode:document.querySelectorAll(".js--input-code"),inputCode:document.querySelector('[name="otp"]'),inputEmail:document.querySelector('[name="username"]'),formUsername:document.querySelector('[name="loginWithUsername"]'),formReminder:document.querySelector('[name="loginWithReminder"]')},this.setTimer(),null!==document.querySelector("."+theme.prefix+"__modal")&&s();for(let e=0;e<this.selectors.linkTo.length;e++)this.selectors.linkTo[e].addEventListener("click",this.linkToClick.bind(this),!1);document.querySelector(this.options.nameInputEmail).addEventListener("input",function(e){this.validateEmail(e.currentTarget)}.bind(this),!1),this.selectors.inputPhone.addEventListener("keypress",function(e){this.isNumberKey(e)}.bind(this),!1);for(let e=0;e<this.selectors.inputsCode.length;e++)this.selectors.inputsCode[e].addEventListener("keydown",this.inputsCodeKeypress.bind(this),!1),this.selectors.inputsCode[e].addEventListener("keyup",this.moveToNextInputDigit.bind(this),!1);this.selectors.inputCode.addEventListener("blur input",function(e){this.setCode($(e.currentTarget).val())}.bind(this),!1),this.selectors.sendPhoneAgain.addEventListener("click",function(e){e.preventDefault();const s=e.currentTarget;if(null!==t.get(this.options.cookieBlockedPhone))return this.goTo(s.getAttribute("data-to")),!1;this.clearCode(),this.submitFormPhone(this.selectors.formPhone)}.bind(this),!1),this.selectors.formPhone.addEventListener("submit",function(e){e.preventDefault();const t=e.currentTarget;this.submitFormPhone(t)}.bind(this),!1),this.selectors.formCode.addEventListener("submit",function(e){e.preventDefault();const t=e.currentTarget,s=this.getCode();if(""==s)return!1;this.focusFirst(t),this.selectors.inputCode.value=s,this.submitForm(t,function(e){this.focusFirst(t),200!==e.status&&300!==e.status||!e.success?this.showError(e,t,e.message):(t.querySelector('[type="submit"]').classList.add(this.options.classLoading),window.location.reload())}.bind(this))}.bind(this),!1),this.selectors.formUsername.addEventListener("submit",function(e){e.preventDefault();const t=e.currentTarget;this.submitForm(t,function(e){200===e.status&&e.success?(t.querySelector('[type="submit"]').classList.add(this.options.classLoading),window.location.reload()):e.success||"The username or password is incorrect"!==e.message?this.showError(e,t,e.message):this.showError(e,t,theme.translation.loginUsernameError)}.bind(this))}.bind(this),!1),this.selectors.formReminder.addEventListener("submit",function(e){e.preventDefault();const t=e.currentTarget;if(!this.validateEmail(t.querySelector(this.options.nameInputEmail)))return!1;this.submitForm(t,function(e){200===e.status&&e.success?(this.showSuccess(e,t,e.message),console.log("Send reminder email")):this.showError(e,t,e.message)}.bind(this))}.bind(this),!1)}e.prototype=Object.assign({},e.prototype,{submitFormPhone:function(e){this.hideError(this.selectors.formCode),this.clearCode(),this.submitForm(e,function(t){let s=this.selectors.inputPhone.value;"0"!==s[0]&&(s="0"+s);const o=this.selectors.putPhone,i=theme.translation.loginCodeSent.replace("{phone}",s.slice(0,3)+"-"+s.slice(3));o.textContent=i,window.console.log(t),200===t.status&&t.success?(this.setCookie(this.options.cookieBlockedPhone,30),this.setTimer(),console.log("Phone send",this)):this.showError(t,e)}.bind(this))},linkToClick:function(e){const t=e.currentTarget,s=t.getAttribute("data-to");"step--phone"===s&&this.clearCode();const o=t.parentNode.querySelector("form");null!==o&&o.querySelector("form input").classList.contains(this.options.classError)&&this.hideError(o),this.goTo(s)},inputsCodeKeypress:function(e){const t=e.currentTarget;if(0===this.index(t)&&t.classList.contains(this.options.classError)&&""!=t.value){this.clearCode();const e=t.closest("form");this.hideError(e)}this.isNumberKey(e)},focusFirst:function(e){const t=e.querySelector("input");""===t.value&&t.focus()},clearCode:function(){for(let e of this.selectors.inputsCode)e.value="",e.classList.remove(this.options.classError);this.selectors.inputCode.value=""},isNumberKey:function(e){const t=e.which?e.which:e.keyCode;if(8===t)this.moveToPrevInputDigit(e);else if(46===t)e.currentTarget.value="";else if(t>31&&(t<48||t>57)&&(t>105||t<96))return e.preventDefault(),!1;return!0},getCurrentDigit:function(e){const t=e.currentTarget;return parseInt(t.getAttribute("id").replace("digit",""))},moveToPrevInputDigit:function(e){let t=this.getCurrentDigit(e);if(t--,0===e.currentTarget.value.length&&t>0){const e=document.getElementById("digit"+t);e.value="",e.focus()}},moveToNextInputDigit:function(e){const t=e.currentTarget,s=e.which?e.which:e.keyCode;if(9===s||16===s)return!0;let o=this.getCurrentDigit(e);if(o++,1===t.value.length&&o<=6){const e=document.getElementById("digit"+o);e.blur(),e.focus(),e.select()}},validateEmail:function(e){let t;return t=e.value.includes("@")?/^[\w\._+]+@([\w-]+\.)+[\w-]{2,4}$/:/^[\w\d-]+$/,""===e.value||t.test(e.value)?(e.classList.remove(this.options.classError),!0):(e.classList.add(this.options.classError),e.focus(),!1)},setCode:function(e){const t=e.split("");for(let e=0;e<this.selectors.inputsCode.length;e++)this.selectors.inputsCode[e].value=t[e]},getCode:function(){let e="";for(let t=0;t<this.selectors.inputsCode.length;t++)e+=this.selectors.inputsCode[t].value;return e},serialize:function(e){let t={};for(let[s,o]of e)void 0!==t[s]?(Array.isArray(t[s])||(t[s]=[t[s]]),t[s].push(o)):t[s]=o;return t},submitForm:async function(e,t){if(void 0===e||""==e.getAttribute("action"))return!1;this.hideError(e);const s=e.querySelector('[type="submit"]');s.classList.add(this.options.classLoading);try{const o=new FormData(e),i=this.serialize(o),n=await fetch(e.getAttribute("action"),{method:e.getAttribute("method"),credentials:"same-origin",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(i)});if(!n.ok)throw new Error("Status Code Error: "+n.status);const r=n.headers.get("content-type");if(!r||!r.includes("application/json"))throw new TypeError("The response is not JSON");const c=await n.json();s.classList.remove(this.options.classLoading);const l=s.getAttribute("data-to");null!=l&&this.goTo(l),void 0!==t&&t(c)}catch(t){console.error("A problem with fetch: ",t.message),this.showError(t,e,t.message)}},hideError:function(e){e.querySelector("."+this.options.classMessageBox).textContent="",e.querySelector("."+this.options.classMessageBox).classList.remove(this.options.classMessageBoxSuccess),e.querySelector("."+this.options.classMessageBox).classList.remove(this.options.classMessageBoxError);for(let t of e.querySelectorAll("input"))t.classList.remove(this.options.classError)},showError:function(e,t,s){const o=t.querySelector("."+this.options.classMessageBox);if(null==o)return!1;if(e.blocked)this.goTo("step--lock");else if(null!=s&&"Mobile number verification failed"==e.message){const t=5-(null!=e.count?e.count:1),i=s.replace("{times}",t);o.classList.remove(this.options.classMessageBoxSuccess),o.classList.add(this.options.classMessageBoxError),o.textContent=i}else null!=s&&""!=e.message&&(o.classList.remove(this.options.classMessageBoxSuccess),o.classList.add(this.options.classMessageBoxError),o.textContent=s);for(let e of t.querySelectorAll("input"))e.classList.add(this.options.classError)},showSuccess:function(e,t,s){window.console.log(e,t,s);const o=t.querySelector("."+this.options.classMessageBox);if(null==o)return!1;null!=s&&(o.classList.remove(this.options.classMessageBoxError),o.classList.add(this.options.classMessageBoxSuccess),o.textContent=s);for(let e of t.querySelectorAll("input"))e.classList.remove(this.options.classError)},goTo:function(e){const t=document.getElementById(e);if(0==t.length||t.offsetWidth>0&&t.offsetHeight>0)return!1;for(let e of this.selectors.step)e.style.display="none";t.style.display="block",this.focusFirst(t)},setCookie:function(e,s,o){let i=new Date,n=i.getTime()+1e3*s;i.setTime(i.getTime()+1e3*s),t.set(e,void 0===o?n:o,i)},insertTimer:function(e,t){let s=parseInt((t-Date.parse(new Date))/1e3);return e.textContent="00:"+(s<10?"0"+s:s),s},setTimer:function(){const e=t.get(this.options.cookieBlockedPhone);if(null!==e){const t=this.selectors.inputPhone.closest("form").querySelector('[type="submit"]'),s=t.querySelector(".btn--text-blocked"),o=parseInt(e),i=s.querySelector("b");this.insertTimer(i,o),t.classList.add("btn--blocked");const n=setInterval(function(){this.insertTimer(i,o)<=1&&(t.classList.remove("btn--blocked"),clearInterval(n))}.bind(this),1e3);return!1}return!0},index:function(e){if(!e)return-1;let t=0;for(;e=e.previousElementSibling;)t++;return t}}),new e}()}))})();