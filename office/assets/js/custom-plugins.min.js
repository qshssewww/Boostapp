/**
 * @Version: 1.0
 * Usage:
 *     $('select').bsappMultiSelect();
 *     $('select[multiple]').bsappMultiSelect('reload');
 *     $('select[multiple]').bsappMultiSelect({
 *     		class: 'my-class',
 *     		searchPlaceholder: 'Searching',
 *          onCheckboxClick: function(e) {
 *				console.log('after checkbox click', e);
 *		    }
 *     });
 *
 **/
!function(e){const t={class:"",label:"",allContainValue:"_all",iconArrow:"",search:!0,searchPlaceholder:"function"==typeof lang?lang("search_user_list"):"Search",searchShowOptGroups:!1,container:e("body"),relatedSelect:null,onLoad:function(e){},onAfterOpen:function(e){},onAfterClose:function(e){},onCheckboxClick:function(e,t){}};var l=1;function s(l,s){const i=e.extend({},t,s);this.element=l,this.settings=i,this.classes={toTop:"to-top",active:"active",selected:"selected",multi:"multi",multiLabel:"multi-label",disabled:"disabled",selInitial:"bsapp--sel",selBox:"bsapp--sel__box",selBoxOptions:"bsapp--sel__options",selTag:"bsapp--sel__tag",selSearch:"bsapp--sel__search",selSearchDelete:"bsapp--sel__delete",selPlaceholder:"bsapp--sel__placeholder",selOptgroup:"bsapp--sel__optgroup",typeCheckbox:'input[type="checkbox"]'},this.init()}s.prototype={init:function(){if("select"!==this.element.nodeName.toLowerCase()||e(this.element).hasClass(this.classes.active)||void 0===e(this.element).attr("multiple"))return!0;this._build(),this._events()},destroy:function(){e(this.element).siblings().remove(),e(this.element).unwrap(),e(this.element).css("display","").removeClass(this.classes.active)},reload:function(){this.destroy(),this.init()},open:function(){const t=e(this.element).closest("."+this.classes.selInitial);this._open(t)},values:function(){return"select"!==this.element.nodeName.toLowerCase()||!e(this.element).hasClass(this.classes.active)||void 0===e(this.element).attr("multiple")||this._getValues()},_events:function(){const t=this,l=t.settings,s=t.classes,i="."+s.selInitial,n="."+s.selBox,a=e(t.element).closest(i);a.on("click","."+s.selPlaceholder,function(l){l.preventDefault();const s=e(this).closest(i);t._open(s)}),a.on("change",s.typeCheckbox,function(i){i.preventDefault();const n=e(this),a=n.val(),o=n.closest("."+s.selBoxOptions);if(0===o.length)return!1;const c=e(t.element),d=l.allContainValue;if(a.indexOf(d)>-1){const l=o.siblings().filter(function(){return e(this).find(s.typeCheckbox).prop("checked")!==n.prop("checked")});t._toggleAllList(l,n.prop("checked"))}else t._checkMultiCheckbox(o,n),t._checkAllCheckbox(o);o.toggleClass(s.selected),c.find('option[value="'+a+'"]').prop("selected",n.prop("checked")),c.trigger("change"),t._updatePlaceholderText(),null!==l.relatedSelect&&c.find("optgroup").length>0&&t._changeRelatedEl(c.find('option[value="'+a+'"]')),"function"==typeof l.onCheckboxClick&&l.onCheckboxClick(n,c)}),a.on("click","."+s.selOptgroup+" .label",function(t){t.preventDefault(),e(this).parent().toggleClass(s.active).find("ul").slideToggle("fast")}),a.on("keyup","."+s.selSearch+" > input",function(l){l.preventDefault();const i=e(this),n=i.val(),a=i.next("."+s.selSearchDelete);if(i.attr("data-last-search")==n)return!0;i.attr("data-last-search",n),0===n.length?a.fadeOut("fast"):a.fadeIn("fast"),t._searchByList(i)}),a.on("click","."+s.selSearchDelete,function(l){l.preventDefault();const s=e(this).prev("input");s.val(""),t._searchByList(s),e(this).fadeOut("fast")}),document.addEventListener("click",t=>{const l=document.querySelector("."+s.selInitial+"."+s.active);if(null!==l&&!l.contains(t.target))return e("body").find(i).removeClass(s.active).find(n).css("display","none").removeClass(s.toTop),!1})},_open:function(t){const l=this.settings,s=this.classes,i="."+s.selInitial,n="."+s.selBox,a=t.find(n);e(i).length>1&&e(i).not(t[0]).removeClass(s.active).find(n).css("display","none");const o=l.container;t.offset().top+t.innerHeight()+a.height()>o.offset().top+o.innerHeight()&&a.addClass(s.toTop),t.toggleClass(s.active),t.hasClass(s.active)?("function"==typeof l.onAfterOpen&&l.onAfterOpen(t),a.slideDown("fast")):(a.css("display","none").removeClass(s.toTop),"function"==typeof l.onAfterClose&&l.onAfterClose(t))},_build:function(){const t=this,l=t.settings,s=t.classes,i=e(t.element);i.css("display","none").addClass(s.active),i.wrap(function(){return'<div class="'+s.selInitial+'"></div>'});const n=i.closest("."+s.selInitial),a=i.find("option:selected").length>0?i.find("option:selected").index():null;let o="";if(null!==a){const e=i.find("option").eq(a);o="<li"+(e.prop("disabled")?"":' class="'+s.selBoxOptions+'"')+">"+e.text()+"</li>"}n.prepend(e("<div>",{class:n.attr("class").replace(/bsapp--sel/g,s.selBox)})),l.search&&0===n.find("."+s.selSearch).length&&n.find("."+s.selBox).prepend(e("<div>",{class:n.attr("class").replace(/bsapp--sel/g,s.selSearch),html:'<input type="text" value="" placeholder="'+l.searchPlaceholder+'" /><button class="'+s.selSearchDelete+'" type="button" aria-label="delete searching"><i class="fal fa-times-circle"></i></button>'})),n.prepend(e("<ul>",{class:n.attr("class").replace(/bsapp--sel/g,s.selPlaceholder),"data-arrow-icon":l.iconArrow,html:o}));let c=[];i.children().each(function(){if("optgroup"===this.nodeName.toLowerCase()){if(e(this).prop("hidden"))return!0;const l=[];e(this).children("option").each(function(){l.push(t._setOptions(e(this)))}),c.push({label:e(this).attr("label"),options:l})}else{if("option"!==this.nodeName.toLowerCase())return!0;c.push(t._setOptions(e(this)))}}),t._loadOptions(c,n),"function"==typeof l.onLoad&&l.onLoad(n)},_loadOptions:function(t,l){const s=this,i=s.classes,n=l.find("."+i.selBox);n.append("<ul></ul>");for(let a in t){const o=t[a];if(o.hidden)continue;const c=e("<li></li>");if(o.hasOwnProperty("options")){c.addClass(l.attr("class").replace(/bsapp--sel/g,i.selOptgroup)),c.append('<span class="label">'+o.label+"</span>"),c.append("<ul></ul>");for(let t in o.options){const n=o.options[t];if(n.hidden)continue;const d=e("<li></li>").addClass(l.attr("class").replace(/bsapp--sel/g,i.selBoxOptions));s._addOption(d,n,a),c.find("> ul").append(d)}}else o.hasOwnProperty("value")&&(c.addClass(l.attr("class").replace(/bsapp--sel/g,i.selBoxOptions)),s._addOption(c,o,a));n.find("> ul").append(c)}""!==s.settings.class&&l.addClass(s.settings.class),s._updatePlaceholderText()},_toggleAllList:function(t,l){const s=this;t.each(function(){const t=e(this),i=t.find(s.classes.typeCheckbox);l?t.addClass(s.classes.selected):t.removeClass(s.classes.selected),i.prop("checked",l),e(s.element).find('option[value="'+i.val()+'"]').prop("selected",l)})},_setOptions:function(e){let t=e.text();const l=void 0!==e.attr("data-multi")&&e.attr("data-multi");let s;return l&&(s=e.parent().find('option[value="'+l+'"]'),t.indexOf(s.text())>-1&&(t=t.replace(s.text(),"").replace(")","").replace("(",""))),{value:e.val(),checked:e.prop("selected"),hidden:l&&s.prop("hidden")?s.prop("hidden"):e.prop("hidden"),disabled:e.prop("disabled"),searchTitle:e.text(),title:t,isMulti:l,isMultiLabel:void 0!==e.attr("data-multi-label")&&e.attr("data-multi-label")}},_addOption:function(t,s,i){if(t.text(s.title),s.isMultiLabel&&t.addClass(this.classes.multiLabel).attr("data-multi-count",e(this.element).find('option[data-multi="'+s.value+'"]').length),s.disabled&&(t.addClass(this.classes.disabled).attr("data-value",s.value),!1===s.isMultiLabel))return!1;const n=e("<label></label>").attr("for","sel__inp-"+l+"-"+i+"-"+s.value);t.wrapInner(n),t.prepend(e('<input type="checkbox" value="" title="" />').val(s.value).attr("name","checkbox--"+(void 0!==e(this.element).attr("name")&&""!==e(this.element).attr("name")?e(this.element).attr("name"):l)).attr("title",s.searchTitle).attr("disabled",s.disabled).attr("id","sel__inp-"+l+"-"+i+"-"+s.value)),l+=1,t.find(this.classes.typeCheckbox).prop("checked",s.checked),s.checked&&(t.addClass("default"),t.addClass(this.classes.selected)),s.isMulti&&(t.find(this.classes.typeCheckbox).attr("multi-value",s.isMulti),t.addClass(this.classes.multi))},_updatePlaceholderText:function(){const t=this,l=t.settings.allContainValue,s=e(t.element),i=s.closest("."+t.classes.selInitial),n=i.find("."+t.classes.selPlaceholder);n.empty();const a=[];let o=0,c=[];s.children().each(function(){const s=this;if("optgroup"===s.nodeName.toLowerCase())e(s).children("option:selected").each(function(){const i=e(this);return!!i.prop("hidden")||(t._checkMultiOption(i)>0||(-1===c.indexOf(e(s).attr("label"))&&c.push(e(s).attr("label")),o++,!(i.val().indexOf(l)>-1)&&void 0))});else if("option"===s.nodeName.toLowerCase()&&e(s).is(":selected")){if(t._checkMultiOption(e(s))>0)return!0;if(o++,e(s).val().indexOf(l)>-1)return!1}});const d=o>3||c.length>1;let p=0;s.children().each(function(){const l=this;if("optgroup"===l.nodeName.toLowerCase()){let s=0;e(l).children("option:selected").each(function(){const e=t._setSelOpts(this,a,d,s);if(!0===e||!1===e)return e;s=e}),d&&0!==s&&a.push(e(l).attr("label")+": "+s)}else if("option"===l.nodeName.toLowerCase()&&e(l).is(":selected")){const e=t._setSelOpts(l,a,d,p);if(!0===e||!1===e)return e;p=e}}),d&&0!==p&&a.push(t.settings.label+": "+p);for(let l=0;l<a.length;l++){const s=e("<li></li>").addClass(i.attr("class").replace(/bsapp--sel/g,t.classes.selTag));s.text(a[l]),n.append(s)}},_setSelOpts:function(t,l,s,i){const n=this.settings.allContainValue,a=e(t).text();return e(t).val().indexOf(n)>-1?(l.push(a),!1):this._checkMultiOption(e(t))>0||(s?i++:l.push(a),i)},_checkMultiOption:function(t){return t.siblings().filter(function(){return e(this).attr("data-multi")===t.val()}).length},_checkMultiCheckbox:function(t,l){const s=this,i=l.prop("checked"),n=t.parent(),a=t.siblings().filter(function(){return e(this).find(s.classes.typeCheckbox).length>0&&e(this).find(s.classes.typeCheckbox).attr("multi-value")===l.val()});if(a.length>0)s._toggleAllList(a,i);else if(void 0!==l.attr("multi-value")&&""!==l.attr("multi-value")){const a=t.siblings().find(s.classes.typeCheckbox+'[value="'+l.attr("multi-value")+'"]'),o=parseInt(a.parent().attr("data-multi-count"))||n.find(s.classes.typeCheckbox+'[multi-value="'+l.attr("multi-value")+'"]').length,c=n.find("li").filter(function(){const t=e(this).find(s.classes.typeCheckbox);return void 0!==t.attr("multi-value")&&t.attr("multi-value")===l.attr("multi-value")&&t.prop("checked")===i}),d=i?c.length===o:c.length<=o;a.length>0&&d&&s._toggleAllList(a.parent(),i)}},_findAllCheckbox:function(t){const l=this,s=l.settings.allContainValue;return t.siblings().filter(function(){return e(this).find(l.classes.typeCheckbox).length>0&&e(this).find(l.classes.typeCheckbox).val().indexOf(s)>-1})},_checkAllCheckbox:function(t){const l=this,s=t.parent(),i=l.settings.allContainValue,n=l._findAllCheckbox(t),a=n.find(l.classes.typeCheckbox);if(a.length>0)if(a.prop("checked"))l._toggleAllList(n,!1);else{const t=s.find("li").filter(function(){const t=e(this).find(l.classes.typeCheckbox);return void 0!==t.val()&&-1===t.val().indexOf(i)&&t.prop("checked")&&!e(this).hasClass(l.classes.multiLabel)}),o=s.find("li."+l.classes.disabled+":not(."+l.classes.multiLabel+")").length||0,c=s.find("li").length-s.find("li."+l.classes.multiLabel).length-o-a.length;t.length>0&&c===t.length&&l._toggleAllList(n,!0)}},_searchByList:function(t){const l=this.settings,s=this.classes,i="."+s.selBox,n=t.val();e(this.element).closest("."+s.selInitial).find(i).find("li:not(."+s.selOptgroup+")").each(function(){const t=e(this),a=t.find(s.typeCheckbox),o=void 0!==a.attr("title")&&""!==a.attr("title")?a.attr("title"):t.text();let c=null;t.hasClass(s.multi)&&(c=t.parent().find(s.typeCheckbox+'[value="'+a.attr("multi-value")+'"]').parent()),o.toLowerCase().indexOf(n.toLowerCase())>-1?(t.show(),null!==c&&0!==n.length&&c.addClass(s.disabled).show().find(s.typeCheckbox).prop("disabled",!0)):t.hide();const d=t.closest("li."+s.selOptgroup);d.hasClass(s.active)&&0===d.find("> ul:visible").length&&d.find("> ul").show(),d.length>0&&(d.show().find(".label").hide(),d.find("li:visible").length?(d.show(),l.searchShowOptGroups&&d.find(".label").show()):(d.hide(),l.searchShowOptGroups&&d.find(".label").hide())),0===n.length&&(null!==c&&c.removeClass(s.disabled).show().find(s.typeCheckbox).removeAttr("disabled"),e(i).find("."+s.selOptgroup).find(".label").show(),e(i).find("."+s.active+"."+s.selOptgroup).find("> ul").hide())})},_changeRelatedEl:function(t){const l=this,s=l.settings.relatedSelect.not(l.element),i=l.settings.allContainValue,n=t.prop("selected"),a=t.attr("value"),o=void 0!==t.attr("data-multi")&&""!==t.attr("data-multi")&&t.attr("data-multi");if(0===s.length)return console.error("[bsappMultiSelect] relatedSelect option error: Not found."),!1;for(let t=0;t<s.length;t++){const c=e(s[t]);if("select"!==s[t].nodeName.toLowerCase()||!c.hasClass(l.classes.active)||void 0===c.attr("multiple")){c.find('option[value="'+a+'"]').prop("hidden",n),console.error("[bsappMultiSelect] relatedSelect option error: Make sure that related element is a multiple select and has already been initialized in the plugin.");continue}const d=c.find('option[value="'+a+'"]');d.prop("hidden")!==n&&d.prop("hidden",n);const p=d.closest("optgroup");if(a.indexOf(i)>-1)p.prop("hidden",n),p.children("option").each(function(){e(this).prop("hidden",n),n&&e(this).prop("selected",!1)});else{if(o){const t=p.children('option[value="'+o+'"]'),l=p.children('option[data-multi="'+o+'"]').length,s=p.children('option[data-multi="'+o+'"]').filter(function(){return e(this).prop("selected")!==n&&e(this).val()!==a&&e(this).prop("hidden")!==n}),i=p.children('option[data-multi="'+o+'"][hidden]').length;0===s.length&&i===l?t.prop("hidden",!0).prop("disabled",!1):(t.prop("hidden",!1),0===i?t.prop("disabled",!1):t.prop("disabled",l!==s.length))}else void 0!==d.attr("data-multi-label")&&p.children('option[data-multi="'+d.attr("data-multi-label")+'"]').each(function(){e(this).prop("hidden",n),n&&e(this).prop("selected",!1)});const t=p.children("option").filter(function(){const t=e(this);return""!==t.val()&&-1===t.val().indexOf(i)&&t.prop("hidden")&&!e(this).hasClass(l.classes.multiLabel)}),s=p.children("option").filter(function(){return""!==e(this).val()&&e(this).val().indexOf(i)>-1}),c=t.length+(0===t.length&&s.prop("hidden")?0:s.length);c===p.children("option").length?(p.prop("hidden",n),p.children("option").each(function(){e(this).prop("hidden",n),n&&e(this).prop("selected",!1)})):(p.prop("hidden",!1),s.length>0&&s.prop("selected",!1).prop("hidden",0!==c))}!1!==d.prop("selected")&&d.prop("selected",!1),c.bsappMultiSelect("reload")}},_getValues:function(){const t=this.settings.allContainValue,l=[];return e(this.element).children().each(function(){const s=this;if("optgroup"===s.nodeName.toLowerCase())e(s).children("option:selected").each(function(){const s=e(this);return!!s.prop("hidden")||(s.val().indexOf(t)>-1?(l.push(s.val()),!1):void l.push(s.val()))});else if("option"===s.nodeName.toLowerCase()&&e(s).is(":selected")){if(e(s).prop("hidden"))return!0;if(e(s).val().indexOf(t)>-1)return l.push(e(s).val()),!1;l.push(e(s).val())}}),l}},e.fn.bsappMultiSelect=function(t){const l=arguments;let i;return void 0===t||"object"==typeof t?this.each(function(){e.data(this,"bsapp_multiselect")||e.data(this,"bsapp_multiselect",new s(this,t))}):"string"==typeof t&&"_"!==t[0]&&"init"!==t?(this.each(function(){const n=e.data(this,"bsapp_multiselect");n instanceof s&&"function"==typeof n[t]&&(i=n[t].apply(n,Array.prototype.slice.call(l,1))),"destroy"===t&&e.data(this,"bsapp_multiselect",null)}),i):void 0}}(jQuery);
